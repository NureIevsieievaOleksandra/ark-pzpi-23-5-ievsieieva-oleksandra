МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ


КАФЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ




Звіт
з лабораторної роботи № 3 з дисципліни
Аналіз та рефакторинг коду





Виконала:                                                                                     Перевірив:
ст. гр. ПЗПІ-23-5                        				ст. викладач кафедри ПІ
Євсєєва Олександра						Сокорчук Ігор Петрович










Харків 2025 
1 ІСТОРІЯ ЗМІН

№	Дата	Версія звіту	Опис змін та виправлень
1	16.12.2025	0.1	Створено звіт
 

2 ЗАВДАННЯ

	Ознайомитися з процесом розробки бізнес логіки та функцій адміністрування серверної частини програмної системи. Отримати практичні навички реалізації бізнес логіки, функцій адміністрування, створення UML-діаграм діяльності та взаємодії, а також перевірки (тестування) роботи серверної частини.
 
3 ОПИС ВИКОНАНОЇ РОБОТИ

	Бізнес логіка серверної частини програмної системи полягає у аналізі даних. Програма накопичує та аналізує події керування освітленням, які містять інформацію про колір, яскравість, прив’язку до лампи або групи ламп, а також час виникнення події. На основі цих даних реалізовано декілька видів аналітики. Кожна подія зберігається в базі даних PostgreSQL і формують історію використання системи освітлення.
	Метод getByColors() відповідає за формування аналітики використання кольорів. У межах цього методу виконується агрегація подій за значеннями кольорових каналів R, G та B, після чого для кожної комбінації підраховується кількість її використань. Отримані результати сортуються за спаданням кількості та обмежуються першими десятьма записами. Такий підхід дозволяє визначити найпопулярніші кольори, які найчастіше використовуються користувачами або автоматизованими сценаріями системи освітлення, що може бути корисним для подальшої оптимізації або персоналізації роботи системи.
1  override suspend fun getByColors(): List<ColorContest> = suspendTransaction {
2      EventTable
3          .select(
4              EventTable.r,
5              EventTable.g,
6              EventTable.b,
7              EventTable.id.count()
8          )
9          .groupBy(
10              EventTable.r,
11              EventTable.g,
12              EventTable.b
13          )
14          .orderBy(EventTable.id.count(), SortOrder.DESC)
15          .limit(10)
16          .map {
17              ColorContest(
18                  r = it[EventTable.r],
19                  g = it[EventTable.g],
20                  b = it[EventTable.b],
21                  count = it[EventTable.id.count()]
22              )}}

	Метод getMathExpectation() призначений для обчислення статистичних характеристик значень кольорових каналів. У рамках даної функції в базі даних обчислюються математичне сподівання та дисперсія, що дозволяє оцінити середній рівень інтенсивності каналу та ступінь розсіювання його значень. Такі показники можуть бути використані для аналізу стабільності вибору кольорів та виявлення загальних тенденцій у використанні освітлення.
1  override suspend fun getMathExpectationR(): Pair<Double, Double> =
 2      suspendTransaction {
 3          val meanR = EventTable.r.avg()
 4          val meanRSq = (EventTable.r * EventTable.r).avg()
 5
 6          EventTable.slice(meanR, meanRSq)
 7              .selectAll()
 8              .singleOrNull()
 9              ?.let {
10                  val mean = (it[meanR] as? Number)?.toDouble() ?: 0.0
11                  val variance = ((it[meanRSq] as? Number)?.toDouble() ?: 0.0) - mean * mean
12                  mean to variance
13              } ?: (0.0 to 0.0)
14      }

	Розробка функції адміністрування серверної частини програмної системи полягає у створенні користувача із особливими дозволами. Для цього реалізовано механізм розмежування доступу на основі ролей користувачів. Користувач може мати спеціальний адміністративний ключ, який надає доступ до функцій аналітики та створення нових об’єктів системи. У коді серверної частини виконується перевірка ролі користувача перед виконанням відповідних операцій: 
1  get {
 2      if (call.isGroupNotValid(enabledRoles = listOf(Role.Admin))) {
 3          return@get call.respond(
 4              status = HttpStatusCode.Forbidden,
 5              message = Error(
 6                  message = "Role not authorized"
 7              )
 8          )
 9      }
10  }

	Таким чином, аналітичні функції та операції створення нових об’єктів доступні виключно адміністраторам системи, що підвищує рівень безпеки та контролю доступу. Водночас операції зміни існуючих об’єктів доступні всім зареєстрованим користувачам, що забезпечує баланс між зручністю використання системи та захистом даних.
	Діаграма діяльності демонструє послідовність дій під час виконання бізнес-логіки серверної частини системи управління освітленням. Вона охоплює процес автентифікації користувача, перевірку ролі, виконання аналітичних операцій або адміністративних дій, а також повернення результату клієнту.
 
Рисунок 1 – UML діаграма діяльності бізнес процесу

	Діаграма взаємодії відображає процес обміну повідомленнями між клієнтом, серверною частиною, модулем авторизації, бізнес-логікою та базою даних PostgreSQL під час виконання аналітичних та адміністративних функцій.
 
Рисунок 2 – UML діаграма взаємодії компонентів системи

	Діаграми відображають загальну логіку взаємодії користувача з серверною частиною системи. Залежно від ролі користувача надається доступ до відповідних операцій. Зареєстровані користувачі можуть переглядати та змінювати дані, тоді як адміністратор додатково має доступ до створення, видалення об’єктів та аналітичних функцій системи. 
ВИСНОВКИ

	У ході виконання лабораторної роботи №3 було розглянуто процес розробки бізнес-логіки та функцій адміністрування серверної частини програмної системи. Під час роботи було реалізовано механізми накопичення та аналізу даних, зокрема обробку подій керування освітленням і формування аналітичної інформації на основі збережених даних.
	Також було реалізовано розмежування доступу до функцій системи за ролями користувачів, що дозволило забезпечити контроль виконання адміністративних операцій та підвищити рівень безпеки серверної частини. У межах лабораторної роботи було отримано практичні навички реалізації бізнес-логіки, функцій адміністрування, а також перевірки коректності роботи серверної частини програмної системи.

 
ВИКОРИСТАНІ ДЖЕРЕЛА

1.	Exposed – офіційна документація. URL:  https://github.com/JetBrains/Exposed (дата звернення: 15.12.2025)
2.	Koin – офіційна документація. URL: https://insert-koin.io (дата звернення: 15.12.2025)
3.	Wikipedia – Mathematical expectation.
URL: https://en.wikipedia.org/wiki/Expected_value (дата звернення: 15.12.2025)
4.	Wikipedia – Variance.
URL: https://en.wikipedia.org/wiki/Variance (дата звернення: 15.12.2025)
 
ДОДАТОК А

Відеозапис: https://youtu.be/PUHDqm0PAS8
00:00 - Пояснення суті роботи 
00:49 - Реалізація ролі адміністратора 
01:07 - Пояснення аналітики 
05:00 - Демонстрація обмеження доступу 
06:37 - Демонстрація запиту

 
ДОДАТОК Б

Повністю код можна подивитись за посиланням: https://github.com/NureIevsieievaOleksandra/ark-pzpi-23-5-ievsieieva-oleksandra/tree/main/Lab3/src 
 

